#include <gtest/gtest.h>
#include <sstream>
#include <filter.hpp>


TEST(Task2_Filter, BasicDeduplication)
{
    std::string input_data =
        "1.0 2.0 3.0\n"
        "4.0 5.0 6.0\n"
        "1.0 2.0 3.0\n"
        "7.0 8.0 9.0\n";

    std::string expected_data =
        "1.0 2.0 3.0\n"
        "4.0 5.0 6.0\n"
        "7.0 8.0 9.0\n";

    std::stringstream in(input_data);
    std::stringstream out;
    task2::filter_duplicates(in, out);

    EXPECT_EQ(out.str(), expected_data);
}

TEST(Task2_Filter, FloatingPointRepresentation)
{
    std::string input_data =
        "1.0 2.0 3.0\n"
        "1.00 2.00 3.00\n";

    std::string expected_data =
        "1.0 2.0 3.0\n";

    std::stringstream in(input_data);
    std::stringstream out;
    task2::filter_duplicates(in, out);

    EXPECT_EQ(out.str(), expected_data);
}

TEST(Task2_Filter, LargeInputSimulator)
{
    std::stringstream in;
    for(int i=0; i < 50000; ++i)
    {
        in << i << ".0 " << i << ".0 " << i << ".0\n";
        in << "1.0 2.0 3.0\n";
    }

    std::stringstream out;
    task2::filter_duplicates(in, out);
    EXPECT_FALSE(out.str().empty());
}

TEST(Task2_Filter, MixedDataIntegration)
{
    const std::string input_data =
        "0.1 0.2 0.3\n"
        "1.1 1.2 1.3\n"
        "2.1 2.2 2.3\n"
        "3.1 3.2 3.3\n"
        "4.1 4.2 4.3\n"
        "5.1 5.2 5.3\n"
        "6.1 6.2 6.3\n"
        "7.1 7.2 7.3\n"
        "8.1 8.2 8.3\n"
        "9.1 9.2 9.3\n"
        "10.1 10.2 10.3\n"
        "11.1 11.2 11.3\n"
        "12.1 12.2 12.3\n"
        "13.1 13.2 13.3\n"
        "14.1 14.2 14.3\n"
        "15.1 15.2 15.3\n"
        "16.1 16.2 16.3\n"
        "10.1 10.2 10.3\n" /* Duplicate 1 */
        "18.1 18.2 18.3\n"
        "19.1 19.2 19.3\n"
        "20.1 20.2 20.3\n"
        "21.1 21.2 21.3\n"
        "22.1 22.2 22.3\n"
        "23.1 23.2 23.3\n"
        "24.1 24.2 24.3\n"
        "0.1 25.2 25.3\n"
        "26.1 26.2 1.3\n"
        "27.1 27.2 27.3\n"
        "28.1 28.2 28.3\n"
        "29.1 29.2 29.3\n"
        "30.1 30.2 30.3\n"
        "31.1 31.2 31.3\n"
        "32.1 32.2 32.3\n"
        "33.1 33.2 33.3\n"
        "34.1 34.2 34.3\n"
        "10.1 35.2 35.3\n"
        "36.1 36.2 11.3\n"
        "37.1 37.2 37.3\n"
        "38.1 38.2 38.3\n"
        "39.1 39.2 39.3\n"
        "40.1 40.2 40.3\n"
        "41.1 41.2 41.3\n"
        "42.1 42.2 42.3\n"
        "43.1 43.2 43.3\n"
        "44.1 44.2 44.3\n"
        "20.1 45.2 45.3\n"
        "46.1 46.2 21.3\n"
        "47.1 47.2 47.3\n"
        "48.1 48.2 48.3\n"
        "49.1 49.2 49.3\n"
        "50.1 5.2 50.3\n"
        "51.1 51.2 51.3\n"
        "52.1 52.2 52.3\n"
        "53.1 53.2 53.3\n"
        "54.1 54.2 54.3\n"
        "30.1 55.2 55.3\n"
        "56.1 56.2 31.3\n"
        "57.1 57.2 57.3\n"
        "58.1 58.2 58.3\n"
        "59.1 59.2 59.3\n"
        "60.1 15.2 60.3\n"
        "61.1 61.2 61.3\n"
        "62.1 62.2 62.3\n"
        "63.1 63.2 63.3\n"
        "64.1 64.2 64.3\n"
        "40.1 65.2 65.3\n"
        "66.1 66.2 41.3\n"
        "67.1 67.2 67.3\n"
        "68.1 68.2 68.3\n"
        "69.1 69.2 69.3\n"
        "70.1 70.2 70.3\n"
        "71.1 71.2 71.3\n"
        "72.1 72.2 72.3\n"
        "73.1 73.2 73.3\n"
        "74.1 74.2 74.3\n"
        "75.1 25.2 75.3\n"
        "70.1 70.2 70.3\n" /* Duplicate */
        "77.1 77.2 77.3\n"
        "78.1 78.2 78.3\n"
        "79.1 79.2 79.3\n"
        "80.1 80.2 80.3\n"
        "81.1 81.2 81.3\n"
        "82.1 82.2 82.3\n"
        "83.1 83.2 83.3\n"
        "84.1 84.2 84.3\n"
        "85.1 35.2 85.3\n"
        "86.1 86.2 86.3\n"
        "80.1 80.2 80.3\n" /* Duplicate */
        "88.1 88.2 88.3\n"
        "89.1 89.2 89.3\n"
        "90.1 90.2 90.3\n"
        "91.1 91.2 91.3\n"
        "92.1 92.2 92.3\n"
        "93.1 93.2 93.3\n"
        "94.1 94.2 94.3\n"
        "95.1 45.2 95.3\n"
        "96.1 96.2 96.3\n"
        "97.1 97.2 97.3\n"
        "98.1 98.2 98.3\n"
        "99.1 99.2 99.3\n";

    const std::string expected_output =
        "0.1 0.2 0.3\n"
        "1.1 1.2 1.3\n"
        "2.1 2.2 2.3\n"
        "3.1 3.2 3.3\n"
        "4.1 4.2 4.3\n"
        "5.1 5.2 5.3\n"
        "6.1 6.2 6.3\n"
        "7.1 7.2 7.3\n"
        "8.1 8.2 8.3\n"
        "9.1 9.2 9.3\n"
        "10.1 10.2 10.3\n"
        "11.1 11.2 11.3\n"
        "12.1 12.2 12.3\n"
        "13.1 13.2 13.3\n"
        "14.1 14.2 14.3\n"
        "15.1 15.2 15.3\n"
        "16.1 16.2 16.3\n"
        "18.1 18.2 18.3\n"
        "19.1 19.2 19.3\n"
        "20.1 20.2 20.3\n"
        "21.1 21.2 21.3\n"
        "22.1 22.2 22.3\n"
        "23.1 23.2 23.3\n"
        "24.1 24.2 24.3\n"
        "0.1 25.2 25.3\n"
        "26.1 26.2 1.3\n"
        "27.1 27.2 27.3\n"
        "28.1 28.2 28.3\n"
        "29.1 29.2 29.3\n"
        "30.1 30.2 30.3\n"
        "31.1 31.2 31.3\n"
        "32.1 32.2 32.3\n"
        "33.1 33.2 33.3\n"
        "34.1 34.2 34.3\n"
        "10.1 35.2 35.3\n"
        "36.1 36.2 11.3\n"
        "37.1 37.2 37.3\n"
        "38.1 38.2 38.3\n"
        "39.1 39.2 39.3\n"
        "40.1 40.2 40.3\n"
        "41.1 41.2 41.3\n"
        "42.1 42.2 42.3\n"
        "43.1 43.2 43.3\n"
        "44.1 44.2 44.3\n"
        "20.1 45.2 45.3\n"
        "46.1 46.2 21.3\n"
        "47.1 47.2 47.3\n"
        "48.1 48.2 48.3\n"
        "49.1 49.2 49.3\n"
        "50.1 5.2 50.3\n"
        "51.1 51.2 51.3\n"
        "52.1 52.2 52.3\n"
        "53.1 53.2 53.3\n"
        "54.1 54.2 54.3\n"
        "30.1 55.2 55.3\n"
        "56.1 56.2 31.3\n"
        "57.1 57.2 57.3\n"
        "58.1 58.2 58.3\n"
        "59.1 59.2 59.3\n"
        "60.1 15.2 60.3\n"
        "61.1 61.2 61.3\n"
        "62.1 62.2 62.3\n"
        "63.1 63.2 63.3\n"
        "64.1 64.2 64.3\n"
        "40.1 65.2 65.3\n"
        "66.1 66.2 41.3\n"
        "67.1 67.2 67.3\n"
        "68.1 68.2 68.3\n"
        "69.1 69.2 69.3\n"
        "70.1 70.2 70.3\n"
        "71.1 71.2 71.3\n"
        "72.1 72.2 72.3\n"
        "73.1 73.2 73.3\n"
        "74.1 74.2 74.3\n"
        "75.1 25.2 75.3\n"
        "77.1 77.2 77.3\n"
        "78.1 78.2 78.3\n"
        "79.1 79.2 79.3\n"
        "80.1 80.2 80.3\n"
        "81.1 81.2 81.3\n"
        "82.1 82.2 82.3\n"
        "83.1 83.2 83.3\n"
        "84.1 84.2 84.3\n"
        "85.1 35.2 85.3\n"
        "86.1 86.2 86.3\n"
        "88.1 88.2 88.3\n"
        "89.1 89.2 89.3\n"
        "90.1 90.2 90.3\n"
        "91.1 91.2 91.3\n"
        "92.1 92.2 92.3\n"
        "93.1 93.2 93.3\n"
        "94.1 94.2 94.3\n"
        "95.1 45.2 95.3\n"
        "96.1 96.2 96.3\n"
        "97.1 97.2 97.3\n"
        "98.1 98.2 98.3\n"
        "99.1 99.2 99.3\n";

    std::stringstream in(input_data);
    std::stringstream out;
    task2::filter_duplicates(in, out);

    EXPECT_EQ(out.str(), expected_output);
}
